<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Director Sales Summaries</title>
  </head>
  <link
    href="https://fonts.googleapis.com/icon?family=Material+Icons"
    rel="stylesheet"
  />

  <style>
    * {
      margin: 0px;
      padding: 0px;
    }

    body {
      background: #e2e7eb;
    }
    .main-panel {
      display: grid;
      grid-template-columns: 250px 1fr;
      grid-template-rows: 60px 1fr;
      grid-template-areas:
        'sidebar header'
        'sidebar Right-panel';
      height: 100vh;
      gap: 3px;
    }

    .sidebar {
      grid-area: sidebar;
      background-color: white;
      color: black;
    }

    .user-profile {
      margin: 20px;
      padding: 20px;
      border-radius: 20px;
      padding: 20px;
    }

    img {
      width: 180px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
    }

    .Director-options {
      margin-top: 20px;
    }

    ul {
      list-style: none;
      margin-top: 50px;
    }

    li {
      padding: 15px;
      font-size: large;
      border-bottom: 1px solid rgba(63, 61, 61, 0.2);
      border-radius: 10px;
      margin: 10px;
      cursor: pointer;
    }

    .Director-options li a {
      display: flex;
      gap: 14px;
      align-items: center;
    }

    li:hover {
      background-color: rgb(185, 184, 182);
    }
    .Director-options li.active {
      background-color: rgb(227, 226, 223);
    }
    .sidebar a {
      text-decoration: none;
      color: black;
    }

    header {
      grid-area: header;
      background-color: white;
      justify-content: space-between;
      align-items: center;
      display: flex;
      padding: 25px 20px;
      border-bottom: 1px solid #ddd;
    }

    #search {
      border: 2.5px solid rgb(128, 209, 143);
      padding: 5px;
      border-radius: 5px;
      width: 25%;
    }

    .Right-panel {
      grid-area: Right-panel;
      border-radius: 10px;
      margin: 5%;
      display: grid;
      grid-template-rows: repeat(auto, 1fr);
    }

    .user-details {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      padding: 20px;
      align-items: end;
      background-color: white;
      border: 1px solid#1e1e2f;
      border-radius: 5px;
    }

    .input-box input {
      padding: 5px;
      border-radius: 5px;
      border: 1px solid #ddd;
      background-color: #f8f9fa;
    }

    .input-box label {
      font-size: 20px;
    }

    .input-box button {
      background: #1e1e2f;
      color: white;
      border-radius: 5px;
      padding: 7px;
      height: 36px;
      cursor: pointer;
    }

    .Director-sales-report {
      background-color: white;
      padding: 20px;
      border: 1px solid#1e1e2f;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
      min-height: 350px;
      border-radius: 5px;
    }

    .Director-sales-report h2 {
      border-bottom: 1px solid black;
      text-align: center;
    }

    .user-header {
      display: flex;
      border-radius: 25px;
      padding: 8px 14px;
      gap: 20px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      align-items: center;
    }

    .Avatar {
      background-color: #1e1e2f;
      color: white;
      padding: 5px;
      border-radius: 20px;
      font-size: larger;
    }

    .user-info {
      display: block;
      align-items: center;
    }

    .user-name {
      font: 30px;
    }

    .user-role {
      font-size: 12px;
      color: gray;
    }

    .Parameters {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      margin-top: 20px;
      gap: 5px;
    }

    #numbers-1 {
      font-size: 170%;
      margin-top: 0px;
      text-align: left;
      color: green;
    }
    #numbers-2 {
      font-size: 170%;
      margin-top: 0px;
      text-align: left;
      color: green;
    }
    #numbers-3 {
      font-size: 170%;
      margin-top: 0px;
      text-align: left;
      color: green;
    }
    #numbers-4 {
      font-size: 170%;
      margin-top: 0px;
      text-align: left;
      color: green;
    }
    #numbers-5 {
      font-size: 170%;
      margin-top: 0px;
      text-align: left;
      color: green;
    }
    #numbers-6 {
      font-size: 170%;
      margin-top: 0px;
      text-align: left;
      color: green;
    }

    #title {
      margin-top: 15px;
      font-size: 100%;
    }
  </style>
  <body>
    <div class="main-panel">
      <!--left side-->
      <div class="sidebar">
        <!--userprofile-->
        <div class="user-profile">
          <img src="Karibu-logo.png" alt="Username" />
        </div>

        <!--Manager options-->
        <div class="Director-options">
          <ul>
            <li>
              <a href="Karibu_Director_DashBoard.html">
                <div class="material-icons">dashboard</div>
                Main DashBoard</a
              >
            </li>
            <li>
              <a href="Karibu_Director_Sales_Report.html"
                ><div class="material-icons">bar_chart</div>
                Sales Report</a
              >
            </li>
            <li class="active">
              <a href="Karibu_Director_Sales_Summaries.html">
                <div class="material-icons">summarize</div>
                Sales Summaries</a
              >
            </li>
            <li>
              <a href="Karibu_Director_AggregatedSummaries.html">
                <div class="material-icons">point_of_sale</div>
                Aggregated Sales</a
              >
            </li>

            <li>
              <a href="Karibu_Employee.html">
                <div class="material-icons">group</div>
                Employees</a
              >
            </li>
          </ul>
        </div>
      </div>

      <header>
        <h2>BRANCHES' SALES SUMMARIES</h2>
        <input type="text" id="search" placeholder="search items" />
        <div class="user-header">
          <div class="Avatar">SB</div>
          <div class="user-info">
            <div class="user-name">
              <h5>Simon</h5>
            </div>
            <div class="user-role">Director</div>
          </div>
        </div>
      </header>

      <!--Right panel-->
      <div class="Right-panel">
        <form>
          <div class="user-details">
            <div class="input-box">
              <label for="Branch">Karibu Branch</label>
              <select id="Branch">
                <option>Select Branch</option>
                <option>Kampala</option>
                <option>Entebbe</option>
              </select>
            </div>

            <div class="input-box">
              <label for="start">Start Date</label>
              <input type="date" id="start" />
            </div>

            <div class="input-box">
              <label for="end">End Date</label>
              <input type="date" id="end" />
            </div>

            <div class="input-box">
              <button type="button" onclick="Totals()">Filter</button>
            </div>
          </div>
        </form>

        <div class="Director-sales-report">
          <h2>SALES REPORT GRAPH</h2>
          <div class="Parameters">
            <h3 id="title">Total Revenue</h3>
            <h4 id="numbers-1"></h4>
            <h3 id="title">Total Cash Revenue</h3>
            <h4 id="numbers-2"></h4>
            <h3 id="title">Total Credit Revenue</h3>
            <h4 id="numbers-3"></h4>
            <h3 id="title">Total Tonnage</h3>
            <h4 id="numbers-4"></h4>
            <h3 id="title">Total Procurement Tonnage</h3>
            <h4 id="numbers-5"></h4>
            <h3 id="title">Total Procurement Cost</h3>
            <h4 id="numbers-6"></h4>
          </div>
        </div>
      </div>
    </div>

    <script>
      const API_URL = 'http://localhost:3000';

      let numbers_1 = document.querySelector('#numbers-1');
      let numbers_2 = document.querySelector('#numbers-2');
      let numbers_3 = document.querySelector('#numbers-3');
      let numbers_4 = document.querySelector('#numbers-4');
      let numbers_5 = document.querySelector('#numbers-5');
      let numbers_6 = document.querySelector('#numbers-6');
      let startDate = document.querySelector('#start');
      let endDate = document.querySelector('#end');
      let Branch = document.querySelector('#Branch');

      async function Totals() {
        try {
          const startDate = document.querySelector('#start').value;
          const endDate = document.querySelector('#end').value;
          const Branch = document.querySelector('#Branch').value;

          let url = `${API_URL}/api/reports/sales-summary`; // ðŸ‘ˆ lowercase reports

          if (startDate && endDate) {
            url += `?startDate=${startDate}&endDate=${endDate}&Branch=${Branch}`;
          }

          let response = await fetch(url);
          let result = await response.json();

          console.log('FULL RESULT:', result);

          numbers_1.textContent = (result.totalRevenue || 0).toLocaleString();
          numbers_2.textContent = (
            result.totalCashRevenue || 0
          ).toLocaleString();
          numbers_3.textContent = (
            result.totalCreditRevenue || 0
          ).toLocaleString();
          numbers_4.textContent = (result.totalTonnage || 0).toLocaleString();

          numbers_5.textContent = (result.procureTonnage || 0).toLocaleString();

          numbers_6.textContent = (result.procureCost || 0).toLocaleString();
        } catch (error) {
          console.error('Error fetching totals:', error);
        }
      }
    </script>
  </body>
</html>
